<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <link th:href="@{/css/bootstrap.min.css}"
          href="../css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container {
            max-width: 560px;
        }

        .field-error {
            border-color: #dc3545;
            color: #dc3545;
        }
    </style>
    <title th:text="#{label.login}"></title>
</head>
<body>
<div class="container">
    <div class="py-5 text-center">
        <h2 th:text="#{label.login}">로그인</h2></div>
    <form action="item.html" th:action th:object="${loginForm}" method="post">
        <div th:if="${#fields.hasGlobalErrors()}">
            <p class="field-error" th:each="err : ${#fields.globalErrors()}"
               th:text="${err}">전체 오류 메시지</p>
        </div>
        <div>
            <label for="id" th:text="#{label.member.id}">아이디</label>
            <input type="text" id="id" minlength="4" maxlength="20" required th:field="*{id}" class="form-control"
                   th:errorclass="field-error">
            <div class="field-error" th:errors="*{id}"/>
        </div>
        <div>
            <label for="password" th:text="#{label.member.password}">비밀번호</label>
            <input type="password" id="password" minlength="4" maxlength="20" required th:field="*{password}"
                   class="form-control"
                   th:errorclass="field-error">
            <div class="field-error" th:errors="*{password}"/>
        </div>
        <hr class="my-4">
        <div class="row">
            <div class="col">
                <button class="w-100 btn btn-primary btn-lg"
                        th:text="#{button.login}"
                        type="submit">
                    로그인
                </button>
            </div>
            <div class="col">
                <button class="w-100 btn btn-secondary btn-lg"
                        onclick="location.href='items.html'"
                        th:text="#{button.cancel}"
                        th:onclick="|location.href='@{/}'|" type="button">취소
                </button>
            </div>
        </div>
    </form>

</div> <!-- /container -->

<script>
    const validityMessage = {
        badInput: '잘못된 입력입니다.',
        patternMismatch: '패턴에 맞게 입력하세요.',
        rangeOverflow: '범위를 초과하였습니다.',
        rangeUnderflow: '범위에 미달하였습니다.',
        stepMismatch: '간격에 맞게 입력하세요',
        tooLong: '최대 20자 이하로 입력해주세요.',
        tooShort: '최소 4자 이상 입력해주세요.',
        typeMismatch: '형식에 맞게 입력해주세요',
        valueMissing: '빈 값을 입력할 수 없습니다.',
    }

    function getMessage(validity) {
        for (const key in validityMessage) {
            if (validity[key]) {
                return validityMessage[key]
            }
        }
    }

    function showError(input) {
        console.log('showError', getMessage(input.validity))
        input.setCustomValidity(getMessage(input.validity) || '')
    }

    function onload() {
        document.querySelectorAll('input').forEach(input => {

            input.addEventListener('invalid', () => {
                document.forms[0].classList.add('was-validated')

                // 커스텀 에러메세지 설정
                showError(input)
            })

            // 인풋시
            input.addEventListener('input', () => {
                if (document.forms[0].classList.contains('was-validated')) {
                    input.reportValidity()
                }
            })
        })
    }

    document.addEventListener('DOMContentLoaded', onload)
</script>
</body>
</html>